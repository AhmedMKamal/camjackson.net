#!/usr/local/bin/node

const mongoose = require('mongoose');
const models = require('../src/models.js');
const confirm = require('../src/helpers.js').confirm;
const User = models.User;
const Post = models.Post;
const db_connection_string = process.env.DB_CONNECTION_STRING || 'mongodb://localhost/camjackson-net';

const firstPostText = 'This is your first post.\n\n Log in with the default credentials to ' +
  'edit or delete it, and to start making posts of your own.';

const prompt = '\n\n***WARNING: THIS OPERATION WILL DESTROY DATA!***\nAre you sure you want to seed the database at ' + db_connection_string;
confirm(prompt).then(function() {
  mongoose.connect(db_connection_string);
  return User.remove({}).exec();
}, function(err) {
  console.log(`Aborting database seed: ${err}`);
}).then(function() {
  return User.create({
    username: 'admin',
    password: 'admin'
  });
}).then(function() {
  return Post.remove({}).exec();
}).then(function() {
  return Post.create({
    title: 'Hello, world!',
    slug: 'hello-world',
    text: firstPostText,
    posted: Date.now()
  });
}).then(function() {
  mongoose.disconnect();
});
